import streamlit as st

# 页面配置
st.set_page_config(page_title="计算说明", layout="wide")

# 标题
st.markdown("# 📄 计算说明文档")

# 概述
st.markdown("## 1. 概述")
st.markdown(
    "本工具帮助您快速理解和复现出货与缺货的关键指标计算方法，\n"
    "涵盖整体达成率、断货风险与综合排序逻辑，确保可即刻上手分析。"
)

# 指标概览
st.markdown("## 2. 核心指标一览")
st.markdown(
    "- **总达成率**：实际出货总量 ÷ 预计出货总量\n"
    "- **平均达成率**：各月达成率算术平均\n"
    "- **加权达成率**：以预计量为权重的平均达成率\n"
    "- **断货日数率**：断货天数 ÷ 考察期总天数\n"
    "- **缺货次数率**：缺货次数 ÷ 出货次数\n"
)

# 指标详细说明
st.markdown("## 3. 指标详细说明")

st.markdown("### 3.1 总达成率")
st.markdown("**公式：** 实际出货总量 ÷ 预计出货总量\n"
            "**作用：** 直观反映整体计划完成情况。")

st.markdown("### 3.2 平均达成率")
st.markdown("**公式：** 月度达成率算术平均\n"
            "**作用：** 平滑单月波动，显示整体趋势。保持各月同等权重。")

st.markdown("### 3.3 加权达成率")
st.markdown(
    "**公式：** ∑(预计量×月度达成率) ÷ ∑预计量\n"
    "**作用：** 更准确反映大批量月份的真实完成度。"
)

st.markdown("### 3.4 断货日数与断货日率  
- **断货实际天数**：将考察期内每一天当作一个事件，若某天任一 SKU 断货，则该天记为断货日；并集后的天数即为实际断货天数。  
- **断货日率**：断货实际天数 ÷ 考察期总天数。  

**概率与期望**：  
我们把“每一天是否断货”当成一个伯努利试验，令 X 为指示变量（断货=1，不断货=0），期望 E[X] 就是断货的概率 p。  
若总天数 D 很大，断货日数 d ≈ D×p，因此算出 d 后，d/D 就是“断货发生的平均概率”——这正是期望意义下的概率估计。  

**集合运算（并集）**：  
断货并集意味着：𝐔_{i} A_i，其中 A_i 表示 SKU_i 在某天断货的事件；只要任一 A_i 成立，即该天落入并集。  
并集运算消除了多 SKU 同日断货的重复计数，使日率计算公平准确。

### 3.5 缺货次数率 缺货次数率")
st.markdown(
    "**公式：** 缺货次数 ÷ 出货次数\n"
    "**作用：** 衡量断货事件发生频率，反映运营稳定度。"
)

# 排序与解读
st.markdown("## 4. 综合排序逻辑与解读")

st.markdown(
    "**排序规则：**\n"
    "1. 按产品状态（在产→新品→废番）\n"
    "2. 同状态内，按加权达成率（低→高）\n"
    "3. 再按断货日率（高→低）和缺货次数率（高→低）\n"
)

st.markdown("**解读要点：**\n"
            "- 达成率低：关注预测准确度与生产/物流执行能力。\n"
            "- 断货多：优化库存补货机制与安全库存水平。\n"
            "- 缺货频繁：提升订单处理和供应链协同效率。"
)

st.markdown("*版本：1.0 • 更新日期：2025-05-18*")